exports.up = async (knex) => {
  await knex.schema
    // USERS
    .createTable('users', tbl => {
      tbl.increments('user_id')
      tbl.integer('user_role').notNullable()
      tbl.string('user_username', 200).notNullable()
      tbl.string('user_password', 200).notNullable()
      tbl.string('user_email', 320).notNullable()
    })
    // TRUCKS
    .createTable('trucks', tbl => {
      tbl.increments('truck_id')
      tbl.string('truck_name').notNullable().unique()
      tbl.string('truck_img').notNullable().unique()
      tbl.integer('user_id')
        .unsigned()
        .notNullable()
        .references('user_id')
        .inTable('users')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // CUISINE TYPE
    .createTable('cuisine_type', tbl => {
      tbl.increments('cuisine_type_id')
      tbl.string('cuisine_type').notNullable()
      tbl.integer('truck_id')
        .unsigned()
        .notNullable()
        .references('truck_id')
        .inTable('trucks')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // FAVORITE TRUCKS
    .createTable('favorite_trucks', tbl => {
      tbl.increments('favorite_truck_id')
      tbl.integer('user_id')
        .unsigned()
        .notNullable()
        .references('user_id')
        .inTable('users')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
      tbl.integer('truck_id')
        .unsigned()
        .notNullable()
        .references('truck_id')
        .inTable('trucks')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // TRUCK RATINGS
    .createTable('truck_ratings', tbl => {
      tbl.increments('truck_rating_id')
      tbl.integer('rating').notNullable()
      tbl.integer('user_id')
        .unsigned()
        .notNullable()
        .references('user_id')
        .inTable('users')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
      tbl.integer('truck_id')
        .unsigned()
        .notNullable()
        .references('truck_id')
        .inTable('trucks')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // DEPARTURE TIMES
    .createTable('departure_times', tbl => {
      tbl.increments('departure_time_id')
      tbl.string('closing_time', 128).notNullable()
      tbl.string('day_of_the_week', 128).notNullable()
      tbl.integer('truck_id')
        .unsigned()
        .notNullable()
        .references('truck_id')
        .inTable('trucks')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // CURRENT LOCATION
    .createTable('current_location', tbl => {
      tbl.increments('current_location_id')
      tbl.float('current_lat').notNullable()
      tbl.float('current_long').notNullable()
      tbl.integer('user_id')
        .unsigned()
        .references('user_id')
        .inTable('users')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
      tbl.integer('truck_id')
        .unsigned()
        .references('truck_id')
        .inTable('trucks')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // MENU ITEMS
    .createTable('menu_items', tbl => {
      tbl.increments('menu_item_id')
      tbl.string('item_name').notNullable()
      tbl.string('item_description').notNullable()
      tbl.integer('item_price').notNullable()
      tbl.integer('truck_id')
        .unsigned()
        .references('truck_id')
        .inTable('trucks')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // MENU ITEM RATINGS
    .createTable('menu_item_ratings', tbl => {
      tbl.increments('menu_item_rating_id')
      tbl.integer('menu_item_rating').notNullable()
      tbl.integer('menu_item_id')
        .unsigned()
        .references('menu_item_id')
        .inTable('menu_items')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
      tbl.integer('user_id')
        .unsigned()
        .references('user_id')
        .inTable('users')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
    // ITEM PHOTOS
    .createTable('item_photos', tbl => {
      tbl.increments('item_photo_id')
      tbl.string('item_photo_img').notNullable()
      tbl.integer('menu_item_id')
        .unsigned()
        .references('menu_item_id')
        .inTable('menu_items')
        .onDelete('CASCADE')
        .onUpdate('CASCADE')
    })
}

exports.down = async (knex) => {
  await knex.schema
    .dropTableIfExists('item_photos')
    .dropTableIfExists('menu_item_ratings')
    .dropTableIfExists('menu_items')
    .dropTableIfExists('current_location')
    .dropTableIfExists('departure_times')
    .dropTableIfExists('truck_ratings')
    .dropTableIfExists('favorite_trucks')
    .dropTableIfExists('cuisine_type')
    .dropTableIfExists('trucks')
    .dropTableIfExists('users')
}
